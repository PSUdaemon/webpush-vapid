<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Voluntary Application Server Identification for Web Push</title>

  <style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  ul.toc, #rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    padding: 0 1em;
    z-index: 1;
  }
  #rfc\.toc {
    top: 16px;
  }
  ul.toc {
    top: 80px;
    overflow: auto;
  }

  body {
    padding-left: 1.5em;
    padding-right: 29em;
  }
}

body {
  font: 15px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 2.5em auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 30px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
}
ul.toc, ul.toc ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
table > thead > th {
  border-bottom: 2px solid #ddd;
}
table > tbody > tr > td, table > tbody > tr > th {
  border-top: 1px solid #ddd;
}
table > tbody > tr:nth-child(2n+1) > td,
table > tbody > tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.right {
  text-align: right;
}
td.reference {
  max-width: 200px;
}
td.right, td.left, td.reference, td.top {
  border-top: none;
}


table.header {
  width: 100%;
}
table.header > tbody > tr > td {
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p, #rfc\.abstract +p {
  font-size: 20px;
  font-weight: 300;
  line-height: 130%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}
td.reference {
  padding-right: 1em;
  vertical-align: top;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}

a {
  text-decoration: none;
}
a:link, a:link:visited {
  color: #2a6496;
}
a:link:hover {
  background-color: #eee;
}

ol, ul {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Notational Conventions"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Self-Identification Alternatives"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Certificates"/>
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Server-Vended Tokens"/>
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Client-Vended Tokens"/>
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 Contact Information Header Field"/>
<link href="#rfc.section.2.5" rel="Chapter" title="2.5 Request Signing"/>
<link href="#rfc.section.2.6" rel="Chapter" title="2.6 Token Binding"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Subscription Association"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Amendments to Subscribing for Push Messages"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Amendments to Requesting Push Message Delivery"/>
<link href="#rfc.section.4" rel="Chapter" title="4 IANA Considerations"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Acknowledgements"/>
<link href="#rfc.references" rel="Chapter" title="7 References"/>
<link href="#rfc.references.1" rel="Chapter" title="7.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="7.2 Informative References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.1 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Thomson, M. and P. Beverloo" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-webpush-vapid-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2015-12-15" />
  <meta name="dct.abstract" content="An application server can voluntarily identify itself to a push service using the described technique.  This identification information can be used by the push service to attribute requests that are made by the same application server to a single entity, and reduce the need for endpoint secrecy by being able to associate subscriptions with an application server.  An application server is further able include additional information the operator of a push service can use to contact the operator of the application server." />
  <meta name="description" content="An application server can voluntarily identify itself to a push service using the described technique.  This identification information can be used by the push service to attribute requests that are made by the same application server to a single entity, and reduce the need for endpoint secrecy by being able to associate subscriptions with an application server.  An application server is further able include additional information the operator of a push service can use to contact the operator of the application server." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">M. Thomson</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">Mozilla</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">P. Beverloo</td>
</tr>
<tr>
  <td class="left">Expires: June 17, 2016</td>
  <td class="right">Google</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">December 15, 2015</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Voluntary Application Server Identification for Web Push<br />
  <span class="filename">draft-ietf-webpush-vapid-latest</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>An application server can voluntarily identify itself to a push service using the described technique.  This identification information can be used by the push service to attribute requests that are made by the same application server to a single entity, and reduce the need for endpoint secrecy by being able to associate subscriptions with an application server.  An application server is further able include additional information the operator of a push service can use to contact the operator of the application server.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on June 17, 2016.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2015 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Notational Conventions</a></li>
</ul><li>2.   <a href="#rfc.section.2">Self-Identification Alternatives</a></li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Certificates</a></li>
<li>2.2.   <a href="#rfc.section.2.2">Server-Vended Tokens</a></li>
<li>2.3.   <a href="#rfc.section.2.3">Client-Vended Tokens</a></li>
<li>2.4.   <a href="#rfc.section.2.4">Contact Information Header Field</a></li>
<li>2.5.   <a href="#rfc.section.2.5">Request Signing</a></li>
<li>2.6.   <a href="#rfc.section.2.6">Token Binding</a></li>
</ul><li>3.   <a href="#rfc.section.3">Subscription Association</a></li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Amendments to Subscribing for Push Messages</a></li>
<li>3.2.   <a href="#rfc.section.3.2">Amendments to Requesting Push Message Delivery</a></li>
</ul><li>4.   <a href="#rfc.section.4">IANA Considerations</a></li>
<li>5.   <a href="#rfc.section.5">Security Considerations</a></li>
<li>6.   <a href="#rfc.section.6">Acknowledgements</a></li>
<li>7.   <a href="#rfc.references">References</a></li>
<ul><li>7.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>7.2.   <a href="#rfc.references.2">Informative References</a></li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a></h1>
<p id="rfc.section.1.p.1">The Web Push protocol <a href="#I-D.ietf-webpush-protocol">[I-D.ietf-webpush-protocol]</a> describes how an application server is able to request that a push service deliver a push message to a user agent.</p>
<p id="rfc.section.1.p.2">As a consequence of the expected deployment architecture, there is no basis for an application server to be known to a push service prior to requesting delivery of a push message.  By the same measure, requesting the creation of a subscription for push message receipts has no prior authentication.  Requiring that the push service be able to authenticate application servers places an unwanted constraint on the interactions between user agents and application servers, who are the ultimate users of a push service.  That constraint would also degrade the privacy-preserving properties the protocol provides.  For these reasons, <a href="#I-D.ietf-webpush-protocol">[I-D.ietf-webpush-protocol]</a> does not define a mandatory system for authentication of application servers.</p>
<p id="rfc.section.1.p.3">An unfortunate consequence of this design is that a push service is exposed to a greater risk of denial of service attack.  While requests from application servers can be indirectly attributed to user agents, this is not always efficient or even sufficient.  Providing more information about the application server more directly to a push service allows the push service to better distinguish between legitimate and bogus requests.</p>
<p id="rfc.section.1.p.4">Additionally, this design also relies on endpoint secrecy as any application server in possession of the endpoint is able to send messages, albeit without payloads.  In situations where usage of a subscription can be limited to a single application server, the ability to associate said subscription with the application server provides could reduce the impact of a data leak.</p>
<p id="rfc.section.1.p.5">This document describes a system whereby an application server can volunteer information about itself to a push service.  At a minimum, this provides a stable identity for the application server, though this could also include contact information, such as an email address.</p>
<p id="rfc.section.1.p.6">A consistent identity can be used by a push service to establish behavioral expectations for an application server.  Significant deviations from an established norm can then be used to trigger exception handling procedures.</p>
<p id="rfc.section.1.p.7">Voluntarily-provided contact information can be used to contact an application server operator in the case of exceptional situations.</p>
<p id="rfc.section.1.p.8">Experience with push service deployment has shown that software errors or unusual circumstances can cause large increases in push message volume.  Contacting the operator of the application server has proven to be valuable.</p>
<p id="rfc.section.1.p.9">Even in the absence of usable contact information, an application server that has a well-established reputation might be given preference over an unidentified application server when choosing whether to discard a push message.</p>
<h2 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> <a href="#notational-conventions" id="notational-conventions">Notational Conventions</a></h2>
<p id="rfc.section.1.1.p.1">The words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;SHOULD&#8221;, and &#8220;MAY&#8221; are used in this document.  It&#8217;s not shouting, when they are capitalized, they have the special meaning described in <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section.1.1.p.2">The terms &#8220;push message&#8221;, &#8220;push service&#8221;, &#8220;application server&#8221;, and &#8220;user agent&#8221; are used as defined in <a href="#I-D.ietf-webpush-protocol">[I-D.ietf-webpush-protocol]</a></p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#self-identification-alternatives" id="self-identification-alternatives">Self-Identification Alternatives</a></h1>
<p id="rfc.section.2.p.1">Several options have been proposed, here are some of the more concrete options.</p>
<h2 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> <a href="#certificates" id="certificates">Certificates</a></h2>
<p id="rfc.section.2.1.p.1">A push service that supports application server self-identification requests a client certificate from application servers.  The client certificate is requested during the TLS <a href="#RFC5246">[RFC5246]</a> handshake.</p>
<p id="rfc.section.2.1.p.2">An application server that does not have a client certificate offers no certificate in response; an application server that wishes to self-identify includes a certificate.</p>
<p id="rfc.section.2.1.p.3">The certificate that the application server offers SHOULD be self-signed (see Section 3.2 of <a href="#RFC5280">[RFC5280]</a>).  The certificate MAY contain an alternative name extension (Section 4.2.1.6 of <a href="#RFC5280">[RFC5280]</a>) that includes contact information.  Of the available options, an email address using the <samp>rfc822Name</samp> form or an HTTP <a href="#RFC7230">[RFC7230]</a> (or HTTPS <a href="#RFC2818">[RFC2818]</a>) <samp>uniformResourceIdentifier</samp> SHOULD be included, though including other options are not prohibited.</p>
<p id="rfc.section.2.1.p.4">The offered end-entity certificate or the public key it contains becomes an identifier for the application server.  Push services are able to reduce the data they retain for an application server, either by extracting important information like the subject public key information (SPKI), by hashing, or a combination.  Of course, a push service might choose to ignore the provided information.</p>
<p id="rfc.section.2.1.p.5">To avoid requesting certificates from user agents, it might be necessary to serve requests from user agents and requests from application servers on different hostnames or port numbers.</p>
<h2 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a> <a href="#server-token" id="server-token">Server-Vended Tokens</a></h2>
<p id="rfc.section.2.2.p.1">In this model, the push service vends a token to each application server that requests it.  That token is kept secret and used as the basis for authentication.</p>
<p id="rfc.section.2.2.p.2">This doesn&#8217;t address the need for contact information, but it addresses the need for a consistent application server identifier.</p>
<p id="rfc.section.2.2.p.3">A Cookie <a href="#RFC6265">[RFC6265]</a> is a token of this nature.  All the considerations regarding the use (and misuse) of HTTP cookies apply should this option be chosen.  A mechanism that makes token theft more difficult, such as <a href="#I-D.ietf-tokbind-https">[I-D.ietf-tokbind-https]</a> might be needed.  However that suggests a separate option (see <a href="#tokbind">Section 2.6</a>).</p>
<p id="rfc.section.2.2.p.4">This information would be repeated with each request, but that overhead is greatly reduced by header compression <a href="#RFC7541">[RFC7541]</a> in HTTP/2 <a href="#RFC7540">[RFC7540]</a>.</p>
<h2 id="rfc.section.2.3"><a href="#rfc.section.2.3">2.3.</a> <a href="#client-token" id="client-token">Client-Vended Tokens</a></h2>
<p id="rfc.section.2.3.p.1">In this model, clients generates a token that it uses to prove ownership over a private key.  Use of the same key over time establishes a continuous identity.</p>
<p id="rfc.section.2.3.p.2">Push message requests can be accompanied by a JSON Web Token (JWT) <a href="#RFC7519">[RFC7519]</a>.  This token is not bound to the request.  As a result, the token is reusable over a limited time, based on the value of the &#8220;exp&#8221; (Expiry) claim in the token.  An &#8220;exp&#8221; claim MUST be included; similarly, an &#8220;aud&#8221; (Audience) claim MUST include the string &#8220;webpush&#8221;.</p>
<p id="rfc.section.2.3.p.3">The JWT is included in an Authorization header field, using an auth-scheme of &#8220;WebPush&#8221;.</p>
<p/>

<dl>
  <dt>Editor&#8217;s Note:</dt>
  <dd style="margin-left: 8">The definition of the &#8220;Bearer&#8221; auth-scheme in <a href="#RFC6750">[RFC6750]</a> is almost perfect, but context would seem to indicate that this is only valid for use with OAuth.</dd>
</dl>
<p id="rfc.section.2.3.p.5">The corresponding public key is included in a JSON Web Key (JWK) <a href="#RFC7517">[RFC7517]</a>.  This would be included in either a newly-defined &#8220;jwk&#8221; parameter of the Crypto-Key header field <a href="#I-D.thomson-http-encryption">[I-D.thomson-http-encryption]</a>; alternatively, the &#8220;p256ecdsa&#8221; parameter defined in <a href="#I-D.thomson-http-content-signature">[I-D.thomson-http-content-signature]</a> could be used to transport a raw key.</p>
<p id="rfc.section.2.3.p.6">For voluntarily-provided contact details, a separate header field could be used (as in <a href="#from">Section 2.4</a>) or the JWT could include claims about identity.  For the latter, the &#8220;sub&#8221; (subject) claim could include a contact URI for the application server.</p>
<p id="rfc.section.2.3.p.7">The JWT MUST use a JSON Web Signature (JWS) <a href="#RFC7515">[RFC7515]</a>.  Both the JWS and JWK MUST use an elliptic curve digital signature (ECDSA) key on the NIST P-256 curve <a href="#FIPS186">[FIPS186]</a>.</p>
<h2 id="rfc.section.2.4"><a href="#rfc.section.2.4">2.4.</a> <a href="#from" id="from">Contact Information Header Field</a></h2>
<p id="rfc.section.2.4.p.1">Contact information for an application server could be included in a header field, either directly (e.g., a From header field, Section 5.5.1 of <a href="#RFC7231">[RFC7231]</a>), or by reference (e.g., a new &#8220;contact&#8221; link relation <a href="#RFC5988">[RFC5988]</a> that identified a vCard <a href="#RFC6350">[RFC6350]</a>).  Note that a From header field is limited to email addresses.</p>
<p id="rfc.section.2.4.p.2">Like an server- or client-vended token (<a href="#server-token">Section 2.2</a>, <a href="#client-token">Section 2.3</a>), contact information would need to be repeated, though that cost is reduced with HTTP/2.</p>
<h2 id="rfc.section.2.5"><a href="#rfc.section.2.5">2.5.</a> <a href="#request-signing" id="request-signing">Request Signing</a></h2>
<p id="rfc.section.2.5.p.1">Signing of push message requests would allow the push service to attribute requests to an application server based on an asymmetric key.  This could be done in any number of ways JWS <a href="#RFC7515">[RFC7515]</a> and HTTP signatures <a href="#I-D.cavage-http-signatures">[I-D.cavage-http-signatures]</a> being the most likely options.  Note that the latter does not provide a means of conveying the signing key, which would be necessary for this application.</p>
<p id="rfc.section.2.5.p.2">Request signing shares much in common with client-vended tokens <a href="#client-token">Section 2.3</a>, but it removes any possibility of token reuse in the interests of security.</p>
<p id="rfc.section.2.5.p.3">Request signing has a few shortcomings:</p>
<p/>

<ul>
  <li>Deciding what to sign is challenging.  Signing only the body of a message is not sufficient to prevent message replay attacks.</li>
  <li>Every message contains a signature, which can increase the load on a server signficantly.  This is especially bad if a signature validation result is input to denial of service mitigation decision making.</li>
</ul>
<h2 id="rfc.section.2.6"><a href="#rfc.section.2.6">2.6.</a> <a href="#tokbind" id="tokbind">Token Binding</a></h2>
<p id="rfc.section.2.6.p.1">The mechanism proposed in <a href="#I-D.ietf-tokbind-https">[I-D.ietf-tokbind-https]</a> can be used to provide a stable identifier for application servers.  This includes a signature over material that is exported from the underlying TLS connection.  Importantly, this does not require a new signature for each request: the same signature is repeated for every request, HTTP/2 is again used to reduce the cost of the repeated information.</p>
<p id="rfc.section.2.6.p.2">Token binding could be used independently of cookies.  Consequently, an application server would not be required to accept and store cookies, though the push service would not be able to offload any state as a result.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#subscription-association" id="subscription-association">Subscription Association</a></h1>
<p id="rfc.section.3.p.1">A stable identifier for an application server - such as a public key or a token - could also be used to associate a subscription with the application server.</p>
<p id="rfc.section.3.p.2">Subscription association reduces the reliance on endpoint secrecy by requiring proof of possession to be demonstrated by an application server when requesting delivery of a push message.  This provides an additional level of protection against leaking of the details of the push subscription.</p>
<h2 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> <a href="#amendments-to-subscribing-for-push-messages" id="amendments-to-subscribing-for-push-messages">Amendments to Subscribing for Push Messages</a></h2>
<p id="rfc.section.3.1.p.1">The user agent includes the public key or token of the application server when requesting the creation of a subscription.  For example, the Web Push API <a href="#API">[API]</a> could allow an application to provide a public key as part of a new field on the <samp>PushSubscriptionOptions</samp> dictionary.</p>
<p id="rfc.section.3.1.p.2">This token might then be added to the request to create a push subscription.</p>
<p id="rfc.section.3.1.p.3">Allowing the inclusion of multiple keys when creating a subscription would allow a subscription to be associated with multiple application servers or application server instances.  This would require more state to be maintained by the push service for each subscription.</p>
<h2 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> <a href="#amendments-to-requesting-push-message-delivery" id="amendments-to-requesting-push-message-delivery">Amendments to Requesting Push Message Delivery</a></h2>
<p id="rfc.section.3.2.p.1">When a subscription has been associated with an application server, the request for push message delivery MUST include proof of possession for the associated private key or token that was used when creating the subscription.  Requests that do not contain proof of possession are rejected with a 401 (Unauthorized) status code.</p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a></h1>
<p id="rfc.section.4.p.1">This document has no IANA actions (yet).</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a></h1>
<p id="rfc.section.5.p.1">TLS 1.2 <a href="#RFC5246">[RFC5246]</a> does not provide any confidentiality protections for client certificates.  A network attacker can therefore see the identification information that is provided by the application server.  A push service MAY choose to offer confidentiality protection for application server identity by initiating TLS renegotiation immediately after establishing the TLS connection at the cost of some additional latency.  Using TLS 1.3 <a href="#I-D.ietf-tls-tls13">[I-D.ietf-tls-tls13]</a> provides confidentiality protection for this information without additional latency.</p>
<p id="rfc.section.5.p.2">An application server might offer falsified contact information.  A push service operator therefore cannot use the presence of unvalidated contact information as input to any security-critical decision-making process.</p>
<p id="rfc.section.5.p.3">Many of the alternative solutions are vulnerable to replay attacks.  Applying narrow limits to the period over which a replayable token can be reused limits the potential value of a stolen token to an attacker and can increase the difficulty of stealing a token.  The token binding solution, which binds tokens to a single TLS connection can make tokens less reusable.</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a></h1>
<p id="rfc.section.6.p.1">This document would have been much worse than it currently is if not for the contributions of Benjamin Bangert, Chris Karlof, Costin Manolache, and others.</p>
<h1 id="rfc.references"><a href="#rfc.references">7.</a> References</h1>
<h2 id="rfc.references.1"><a href="#rfc.references.1">7.1.</a> Normative References</h2>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="FIPS186">[FIPS186]</b>
      </td>
      <td class="top"><a>National Institute of Standards and Technology (NIST)</a>, "<a>Digital Signature Standard (DSS)</a>", NIST PUB 186-4 , July 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-webpush-protocol">[I-D.ietf-webpush-protocol]</b>
      </td>
      <td class="top"><a>Thomson, M.</a>, <a>Damaggio, E.</a> and <a>B. Raymor</a>, "<a href="http://tools.ietf.org/html/draft-ietf-webpush-protocol-01">Generic Event Delivery Using HTTP Push</a>", Internet-Draft draft-ietf-webpush-protocol-01, October 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2818">[RFC2818]</b>
      </td>
      <td class="top"><a>Rescorla, E.</a>, "<a href="http://tools.ietf.org/html/rfc2818">HTTP Over TLS</a>", RFC 2818, DOI 10.17487/RFC2818, May 2000.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5246">[RFC5246]</b>
      </td>
      <td class="top"><a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, DOI 10.17487/RFC5246, August 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5280">[RFC5280]</b>
      </td>
      <td class="top"><a>Cooper, D.</a>, <a>Santesson, S.</a>, <a>Farrell, S.</a>, <a>Boeyen, S.</a>, <a>Housley, R.</a> and <a>W. Polk</a>, "<a href="http://tools.ietf.org/html/rfc5280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>", RFC 5280, DOI 10.17487/RFC5280, May 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7230">[RFC7230]</b>
      </td>
      <td class="top"><a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>", RFC 7230, DOI 10.17487/RFC7230, June 2014.</td>
    </tr>
  </tbody>
</table>
<h2 id="rfc.references.2"><a href="#rfc.references.2">7.2.</a> Informative References</h2>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="API">[API]</b>
      </td>
      <td class="top"><a>van Ouwerkerk, M.</a> and <a>M. Thomson</a>, "<a href="https://w3c.github.io/push-api/">Web Push API</a>", 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.cavage-http-signatures">[I-D.cavage-http-signatures]</b>
      </td>
      <td class="top"><a>Cavage, M.</a> and <a>M. Sporny</a>, "<a href="http://tools.ietf.org/html/draft-cavage-http-signatures-05">Signing HTTP Messages</a>", Internet-Draft draft-cavage-http-signatures-05, October 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-tls-tls13">[I-D.ietf-tls-tls13]</b>
      </td>
      <td class="top"><a>Rescorla, E.</a>, "<a href="http://tools.ietf.org/html/draft-ietf-tls-tls13-10">The Transport Layer Security (TLS) Protocol Version 1.3</a>", Internet-Draft draft-ietf-tls-tls13-10, October 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-tokbind-https">[I-D.ietf-tokbind-https]</b>
      </td>
      <td class="top"><a>Popov, A.</a>, <a>Nystrom, M.</a>, <a>Balfanz, D.</a> and <a>A. Langley</a>, "<a href="http://tools.ietf.org/html/draft-ietf-tokbind-https-02">Token Binding over HTTP</a>", Internet-Draft draft-ietf-tokbind-https-02, October 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.thomson-http-content-signature">[I-D.thomson-http-content-signature]</b>
      </td>
      <td class="top"><a>Thomson, M.</a>, "<a href="http://tools.ietf.org/html/draft-thomson-http-content-signature-00">Content-Signature Header Field for HTTP</a>", Internet-Draft draft-thomson-http-content-signature-00, July 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.thomson-http-encryption">[I-D.thomson-http-encryption]</b>
      </td>
      <td class="top"><a>Thomson, M.</a>, "<a href="http://tools.ietf.org/html/draft-thomson-http-encryption-02">Encrypted Content-Encoding for HTTP</a>", Internet-Draft draft-thomson-http-encryption-02, October 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4648">[RFC4648]</b>
      </td>
      <td class="top"><a>Josefsson, S.</a>, "<a href="http://tools.ietf.org/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>", RFC 4648, DOI 10.17487/RFC4648, October 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5988">[RFC5988]</b>
      </td>
      <td class="top"><a>Nottingham, M.</a>, "<a href="http://tools.ietf.org/html/rfc5988">Web Linking</a>", RFC 5988, DOI 10.17487/RFC5988, October 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6265">[RFC6265]</b>
      </td>
      <td class="top"><a>Barth, A.</a>, "<a href="http://tools.ietf.org/html/rfc6265">HTTP State Management Mechanism</a>", RFC 6265, DOI 10.17487/RFC6265, April 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6350">[RFC6350]</b>
      </td>
      <td class="top"><a>Perreault, S.</a>, "<a href="http://tools.ietf.org/html/rfc6350">vCard Format Specification</a>", RFC 6350, DOI 10.17487/RFC6350, August 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6750">[RFC6750]</b>
      </td>
      <td class="top"><a>Jones, M.</a> and <a>D. Hardt</a>, "<a href="http://tools.ietf.org/html/rfc6750">The OAuth 2.0 Authorization Framework: Bearer Token Usage</a>", RFC 6750, DOI 10.17487/RFC6750, October 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7231">[RFC7231]</b>
      </td>
      <td class="top"><a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>", RFC 7231, DOI 10.17487/RFC7231, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7515">[RFC7515]</b>
      </td>
      <td class="top"><a>Jones, M.</a>, <a>Bradley, J.</a> and <a>N. Sakimura</a>, "<a href="http://tools.ietf.org/html/rfc7515">JSON Web Signature (JWS)</a>", RFC 7515, DOI 10.17487/RFC7515, May 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7517">[RFC7517]</b>
      </td>
      <td class="top"><a>Jones, M.</a>, "<a href="http://tools.ietf.org/html/rfc7517">JSON Web Key (JWK)</a>", RFC 7517, DOI 10.17487/RFC7517, May 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7519">[RFC7519]</b>
      </td>
      <td class="top"><a>Jones, M.</a>, <a>Bradley, J.</a> and <a>N. Sakimura</a>, "<a href="http://tools.ietf.org/html/rfc7519">JSON Web Token (JWT)</a>", RFC 7519, DOI 10.17487/RFC7519, May 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7540">[RFC7540]</b>
      </td>
      <td class="top"><a>Belshe, M.</a>, <a>Peon, R.</a> and <a>M. Thomson</a>, "<a href="http://tools.ietf.org/html/rfc7540">Hypertext Transfer Protocol Version 2 (HTTP/2)</a>", RFC 7540, DOI 10.17487/RFC7540, May 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7541">[RFC7541]</b>
      </td>
      <td class="top"><a>Peon, R.</a> and <a>H. Ruellan</a>, "<a href="http://tools.ietf.org/html/rfc7541">HPACK: Header Compression for HTTP/2</a>", RFC 7541, DOI 10.17487/RFC7541, May 2015.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Martin Thomson</span> 
	  <span class="n hidden">
		<span class="family-name">Thomson</span>
	  </span>
	</span>
	<span class="org vcardline">Mozilla</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:martin.thomson@gmail.com">martin.thomson@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Peter Beverloo</span> 
	  <span class="n hidden">
		<span class="family-name">Beverloo</span>
	  </span>
	</span>
	<span class="org vcardline">Google</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:beverloo@google.com">beverloo@google.com</a></span>

  </address>
</div>

  <div class="github-fork-ribbon-wrapper"><div class="github-fork-ribbon"><a href="https://github.com/martinthomson/webpush-vapid">Fork me on GitHub</a></div></div>
</body>
</html>
